<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Stoja Trade - AI-Powered Real Estate Assistant Demo"
    />
    <title>Stoja Trade AI Assistant Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- ElevenLabs Widget Positioning -->
    <style>
      #elevenlabs-widget-container {
        position: fixed !important;
        left: 20px !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        z-index: 9998 !important;
        pointer-events: none !important;
      }
      
      #elevenlabs-widget-container elevenlabs-convai {
        pointer-events: auto !important;
        position: relative !important;
        display: block !important;
      }
    </style>
    <script>
      // Inject styles into shadow DOM to fix positioning
      function injectShadowStyles() {
        const widget = document.querySelector('elevenlabs-convai');
        if (!widget || !widget.shadowRoot) return;
        
        const shadowRoot = widget.shadowRoot;
        
        // Ensure widget element has proper display
        widget.style.display = 'block';
        widget.style.width = 'auto';
        widget.style.height = 'auto';
        widget.style.minWidth = '280px';
        
        // Find the root container div (first child of shadow root)
        const rootContainer = shadowRoot.firstElementChild;
        if (rootContainer) {
          const rect = rootContainer.getBoundingClientRect();
          const computedStyle = window.getComputedStyle(rootContainer);
          const inlineStyle = rootContainer.getAttribute('style') || '';
          
          // Check if it's positioned off-screen or using fixed positioning
          const isOffScreen = rect.left < -50 || rect.left > window.innerWidth;
          const isFixed = computedStyle.position === 'fixed' || inlineStyle.includes('position: fixed') || inlineStyle.includes('position:fixed');
          
          if (isFixed || isOffScreen) {
            // Force to static/relative and reset positioning
            rootContainer.style.setProperty('position', 'static', 'important');
            rootContainer.style.setProperty('left', 'auto', 'important');
            rootContainer.style.setProperty('right', 'auto', 'important');
            rootContainer.style.setProperty('top', 'auto', 'important');
            rootContainer.style.setProperty('bottom', 'auto', 'important');
            rootContainer.style.setProperty('transform', 'none', 'important');
            rootContainer.style.setProperty('margin', '0', 'important');
          }
        }
        
        // Find and fix any other fixed-positioned elements
        const allElements = shadowRoot.querySelectorAll('*');
        allElements.forEach(function(el) {
          const computedStyle = window.getComputedStyle(el);
          const inlineStyle = el.getAttribute('style') || '';
          const rect = el.getBoundingClientRect();
          
          // Only fix if it's actually fixed AND off-screen
          if ((computedStyle.position === 'fixed' || inlineStyle.includes('position: fixed') || inlineStyle.includes('position:fixed')) && 
              (rect.left < -50 || rect.left > window.innerWidth)) {
            el.style.setProperty('position', 'static', 'important');
            el.style.setProperty('left', 'auto', 'important');
            el.style.setProperty('right', 'auto', 'important');
            el.style.setProperty('top', 'auto', 'important');
            el.style.setProperty('bottom', 'auto', 'important');
            el.style.setProperty('transform', 'none', 'important');
          }
        });
        
        // Inject minimal CSS - only target fixed positioned elements that are problematic
        let styleEl = shadowRoot.querySelector('style[data-position-fix]');
        if (!styleEl) {
          styleEl = document.createElement('style');
          styleEl.setAttribute('data-position-fix', 'true');
          shadowRoot.insertBefore(styleEl, shadowRoot.firstChild);
        }
        
        styleEl.textContent = `
          :host > *:first-child {
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            margin: 0 !important;
          }
        `;
      }
      
      // Ensure widget container stays positioned correctly
      function ensureWidgetPosition() {
        const container = document.getElementById('elevenlabs-widget-container');
        if (container) {
          container.style.cssText = `
            position: fixed !important;
            left: 20px !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            z-index: 9998 !important;
            pointer-events: none !important;
          `;
        }
        
        // Inject shadow DOM styles
        injectShadowStyles();
      }
      
      // Run on load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', ensureWidgetPosition);
      } else {
        ensureWidgetPosition();
      }
      
      window.addEventListener('load', ensureWidgetPosition);
      window.addEventListener('resize', ensureWidgetPosition);
      
      // Aggressive polling to catch shadow DOM initialization
      let attempts = 0;
      const interval = setInterval(function() {
        ensureWidgetPosition();
        attempts++;
        if (attempts > 40) clearInterval(interval);
      }, 500);
      
      // MutationObserver for shadow DOM changes
      const observer = new MutationObserver(function() {
        ensureWidgetPosition();
      });
      
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
    </script>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    
    <!-- ElevenLabs Conversational AI Widget - Wrapped in positioned container -->
    <div id="elevenlabs-widget-container" style="position: fixed; left: 20px; top: 50%; transform: translateY(-50%); z-index: 9998; pointer-events: none;">
      <elevenlabs-convai agent-id="agent_7701k80ng0s4e9dasnydy605s42g" style="pointer-events: auto;"></elevenlabs-convai>
    </div>
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
  </body>
</html>

